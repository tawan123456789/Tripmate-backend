generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String          @id @default(uuid()) @map("user_id") @db.Uuid
  fname          String
  lname          String
  birthDate      DateTime?       @map("birth_date") @db.Date
  role           String?
  email          String          @unique
  password       String
  profileImg     String?         @map("profile_img")
  phone          String?
  status         String?
  createdAt      DateTime        @default(now()) @map("created_at")
  updatedAt      DateTime?       @updatedAt @map("updated_at")
  username       String          @unique
  gender         String          @default("Other")
  bookmarks      Bookmark[]
  discountsMade  Discount[]      @relation("DiscountMaker")
  discounts      Discount[]      @relation("DiscountOwner")
  ownedGroups    Group[]         @relation("GroupOwner")
  reviews        Review[]
  ownedTripPlans TripPlan[]      @relation("TripPlanOwner")
  memberOf       UserJoinGroup[]
  services       UserService[]   @relation("ServiceOwner")

  @@map("User")
}

model Group {
  id          String          @id @map("group_id")
  ownerId     String          @map("owner_id") @db.Uuid
  groupName   String          @map("group_name")
  groupImg    String?         @map("group_img")
  status      String?
  createdAt   DateTime        @default(now()) @map("created_at")
  updatedAt   DateTime?       @updatedAt @map("updated_at")
  tripPlansId String?         @map("trip_plans_id")
  description String?         @default("No description") @map("description")
  profileImg  String?         @map("profile_img")
  bookings    Booking[]
  owner       User            @relation("GroupOwner", fields: [ownerId], references: [id])
  tripPlans   TripPlan?       @relation(fields: [tripPlansId], references: [id])
  members     UserJoinGroup[]

  @@index([ownerId])
  @@map("Group")
}

model UserJoinGroup {
  groupId  String   @map("group_id")
  userId   String   @map("user_id") @db.Uuid
  status   String?
  joinDate DateTime @default(now()) @map("join_date")
  group    Group    @relation(fields: [groupId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([groupId, userId])
  @@map("UserJoinGroup")
}

model TripPlan {
  id           String        @id @map("trip_id")
  ownerId      String        @map("owner_id") @db.Uuid
  createAt     DateTime      @default(now()) @map("create_at")
  updateAt     DateTime?     @updatedAt @map("update_at")
  deleteAt     DateTime?     @map("delete_at")
  tripName     String        @map("trip_name")
  tripImg      String?       @map("trip_img")
  status       String?
  note         String?
  startDate    DateTime?     @map("start_date") @db.Date
  endDate      DateTime?     @map("end_date") @db.Date
  groups       Group[]
  owner        User          @relation("TripPlanOwner", fields: [ownerId], references: [id])
  tripServices TripService[]
  units        TripUnit[]

  @@index([ownerId])
  @@map("TripPlan")
}

model TripUnit {
  id             String       @id @map("unit_id")
  tripId         String       @map("trip_id")
  placeId        String?      @map("place_id")
  timeStampStart DateTime     @map("time_stamp_start")
  duration       Int?
  status         String?
  note           String?
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime?    @updatedAt @map("updated_at")
  deletedAt      DateTime?    @map("deleted_at")
  serviceId      String?      @map("service_id")
  place          Place?       @relation(fields: [placeId], references: [id], onDelete: Restrict)
  service        UserService? @relation(fields: [serviceId], references: [id])
  trip           TripPlan     @relation(fields: [tripId], references: [id], onDelete: Cascade)

  @@index([tripId])
  @@index([placeId])
  @@map("TripUnit")
}

model TripService {
  id        String      @id @map("trip_service_id")
  tripId    String      @map("trip_id")
  serviceId String      @map("service_id")
  date      DateTime    @map("date_time") @db.Timestamp(6)
  status    String?
  createdAt DateTime    @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime?   @updatedAt @map("updated_at") @db.Timestamp(6)
  service   UserService @relation(fields: [serviceId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_tripservice_service")
  trip      TripPlan    @relation(fields: [tripId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_tripservice_trip")

  @@index([serviceId], map: "idx_tripservice_service_id")
  @@index([tripId], map: "idx_tripservice_trip_id")
  @@map("TripService")
}

model Place {
  id          String     @id @map("place_id")
  locationId  String?    @map("location_id")
  name        String
  description String?
  placeImg    String?    @map("place_img")
  location    Location?  @relation(fields: [locationId], references: [id])
  tripUnits   TripUnit[]

  @@index([locationId])
  @@map("Place")
}

model Location {
  id            String        @id @map("location_id")
  lat           Float
  long          Float
  name          String
  detail        String?
  status        String?
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime?     @updatedAt @map("updated_at")
  deletedAt     DateTime?     @map("deleted_at")
  country       String?
  province      String?
  address       String?
  district      String?
  street        String?
  zipCode       String?       @map("zip_code")
  places        Place[]
  servicesByLoc UserService[] @relation("ServiceLoc")

  @@map("Location")
}

model UserService {
  id              String           @id @map("service_id")
  ownerId         String           @map("owner_id") @db.Uuid
  locationId      String?          @map("location_id")
  name            String
  description     String?
  serviceImg      String?          @map("service_img")
  status          String?
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime?        @updatedAt @map("updated_at")
  deletedAt       DateTime?        @map("deleted_at")
  type            String?
  bookings        Booking[]
  bookmarks       Bookmark[]
  carRentalCenter CarRentalCenter?
  guide           Guide?
  hotel           Hotel?
  restaurant      Restaurant?
  reviews         Review[]
  tripServices    TripService[]
  tripUnits       TripUnit[]
  location        Location?        @relation("ServiceLoc", fields: [locationId], references: [id])
  owner           User             @relation("ServiceOwner", fields: [ownerId], references: [id])

  @@index([ownerId])
  @@index([locationId])
  @@map("UserService")
}

model Hotel {
  id              String      @id @map("hotel_id")
  name            String
  description     String?
  facility        String?
  rating          Decimal?    @db.Decimal(3, 1)
  image           String?
  breakfast       String?
  checkIn         String?
  checkOut        String?
  contact         String?
  facilities      Json?
  locationSummary String?     @map("location_text")
  nearbyLocations String[]    @default([]) @map("nearby_locations")
  petAllow        Boolean?    @map("pet_allow")
  pictures        String[]    @default([])
  star            Int?
  subtopicRatings Json?       @map("subtopic_ratings")
  type            String?
  service         UserService @relation(fields: [id], references: [id], onDelete: Cascade)
  rooms           Room[]

  @@map("Hotel")
}

model Room {
  id            String   @map("room_id")
  hotelId       String   @map("hotel_id")
  pricePerNight Decimal? @map("price_per_night") @db.Decimal(10, 2)
  bedType       String?  @map("bed_type")
  personPerRoom Int?     @map("person_per_room")
  description   String?
  image         String?
  facilities    String[] @default([]) @map("facilities")
  name          String?
  pictures      String[] @default([])
  sizeSqm       Int?     @map("size_sqm")
  hotel         Hotel    @relation(fields: [hotelId], references: [id], onDelete: Cascade)

  @@id([id, hotelId])
  @@index([hotelId])
  @@map("Room")
}

model Restaurant {
  id                String      @id @map("restaurant_id")
  name              String
  description       String?
  menu              String?
  image             String?
  rating            Decimal?    @db.Decimal(3, 1)
  priceLevel        Int?        @map("price_level")
  contact           String?
  contacts          Json?
  cuisine           String?
  dietaryTags       String[]    @default([])
  facilities        Json?
  facility          String?
  locationSummary   String?     @map("location_text")
  nearbyLocations   String[]    @default([]) @map("nearby_locations")
  openingHours      Json?       @map("opening_hours")
  paymentMethods    String[]    @default([]) @map("payment_methods")
  petAllow          Boolean?    @map("pet_allow")
  pictures          String[]    @default([])
  reservationPolicy Json?       @map("reservation_policy")
  services          String[]    @default([])
  subtopicRatings   Json?       @map("subtopic_ratings")
  type              String?
  service           UserService @relation(fields: [id], references: [id], onDelete: Cascade)
  tables            Table[]

  @@map("Restaurant")
}

/// ===================================
/// CAR RENTAL CENTER (rich like Hotel)
/// ===================================
model CarRentalCenter {
  id              String      @id @map("crc_id")
  name            String
  description     String?
  image           String?
  rating          Decimal?    @db.Decimal(3, 1)
  branches        Json?       @map("branches")
  contact         String?
  contacts        Json?
  facilities      Json?
  facility        String?
  locationSummary String?     @map("location_text")
  nearbyLocations String[]    @default([]) @map("nearby_locations")
  openingHours    Json?       @map("opening_hours")
  paymentMethods  String[]    @default([]) @map("payment_methods")
  pickupDropoff   Json?       @map("pickup_dropoff")
  pictures        String[]    @default([])
  policies        Json?
  requiredDocs    String[]    @default([]) @map("required_docs")
  subtopicRatings Json?       @map("subtopic_ratings")
  type            String?
  cars            Car[]
  service         UserService @relation(fields: [id], references: [id], onDelete: Cascade)

  @@map("CarRentalCenter")
}

/// รถให้เช่า (ถ้ายังไม่มีโมเดล Car ให้ใช้ด้านล่างนี้ได้)
model Car {
  id             String          @id @map("car_id")
  crcId          String          @map("crc_id")
  pricePerDay    Decimal?        @map("price_per_day") @db.Decimal(10, 2)
  model          String?
  description    String?         @map("description")
  seats          Int?            @map("carseat")
  image          String?
  createdAt      DateTime?       @map("created_at")
  updatedAt      DateTime?       @map("updated_at")
  availability   Json?
  brand          String?
  currency       String?         @default("THB")
  deposit        Decimal?        @db.Decimal(10, 2)
  doors          Int?
  features       String[]        @default([])
  fuelType       String?
  insurance      Json?
  luggage        Int?
  mileageLimitKm Int?            @map("mileage_limit_km")
  pictures       String[]        @default([])
  pricePerHour   Decimal?        @map("price_per_hour") @db.Decimal(10, 2)
  transmission   String?
  year           Int?
  rentalCenter   CarRentalCenter @relation(fields: [crcId], references: [id], onDelete: Cascade)

  @@index([crcId])
  @@map("Car")
}

/// ===============================
/// GUIDE (rich like Hotel)
/// ===============================
model Guide {
  id              String      @id @map("guide_id")
  name            String
  description     String?
  image           String?
  rating          Decimal?    @db.Decimal(3, 1)
  pay             Decimal?    @map("pay")
  availability    Json?
  contact         String?
  contacts        Json?
  currency        String?     @default("THB")
  dayRate         Decimal?    @map("day_rate") @db.Decimal(10, 2)
  experienceYears Int?        @map("experience_years")
  hourlyRate      Decimal?    @map("hourly_rate") @db.Decimal(10, 2)
  languages       String[]    @default([])
  licenseId       String?     @map("license_id")
  locationSummary String?     @map("location_text")
  nearbyLocations String[]    @default([]) @map("nearby_locations")
  overtimeRate    Decimal?    @map("overtime_rate") @db.Decimal(10, 2)
  pictures        String[]    @default([])
  policies        Json?
  regionsCovered  String[]    @default([])
  specialties     String[]    @default([])
  subtopicRatings Json?       @map("subtopic_ratings")
  verified        Boolean?    @default(false)
  service         UserService @relation(fields: [id], references: [id], onDelete: Cascade)

  @@map("Guide")
}

model Table {
  id           String     @map("table_id")
  restaurantId String     @map("restaurant_id")
  model        String?
  description  String?
  seat         Int?
  pricePerSeat Decimal?   @map("price_per_seat") @db.Decimal(10, 2)
  status       String?
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime?  @updatedAt @map("updated_at")
  deletedAt    DateTime?  @map("deleted_at")
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  @@id([id, restaurantId])
  @@index([restaurantId])
  @@map("Table")
}

model Review {
  id        String      @id @map("review_id")
  serviceId String      @map("service_id")
  userId    String      @map("user_id") @db.Uuid
  comment   String?
  score     Int?
  createdAt DateTime    @default(now()) @map("created_at")
  updatedAt DateTime?   @updatedAt @map("updated_at")
  status    String?
  image     String?
  service   UserService @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([serviceId])
  @@index([userId])
  @@map("Review")
}

model Bookmark {
  id        String      @id @default(uuid()) @map("bookmark_id")
  serviceId String      @map("service_id")
  userId    String      @map("user_id") @db.Uuid
  createdAt DateTime    @default(now()) @map("created_at")
  updatedAt DateTime?   @updatedAt @map("updated_at")
  status    String?
  service   UserService @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([serviceId])
  @@index([userId])
  @@map("Bookmark")
}

model Booking {
  id               String      @id @map("booking_id")
  serviceId        String      @map("service_id")
  groupId          String      @map("group_id")
  startBookingDate DateTime    @map("start_booking_date")
  endBookingDate   DateTime?   @map("end_booking_date")
  note             String?
  createdAt        DateTime    @default(now()) @map("created_at")
  updatedAt        DateTime?   @updatedAt @map("updated_at")
  status           String?
  group            Group       @relation(fields: [groupId], references: [id])
  service          UserService @relation(fields: [serviceId], references: [id])

  @@index([serviceId])
  @@index([groupId])
  @@map("Booking")
}

model Discount {
  id        String    @id @map("discount_id")
  ownerId   String    @map("owner_id") @db.Uuid
  value     Decimal?  @db.Decimal(10, 2)
  type      String?
  status    String?
  createdAt DateTime  @default(now()) @map("created_at")
  expiredAt DateTime? @map("expired_at")
  maker_id  String?   @map("maker_id") @db.Uuid
  maker     User?     @relation("DiscountMaker", fields: [maker_id], references: [id])
  owner     User      @relation("DiscountOwner", fields: [ownerId], references: [id])

  @@index([ownerId])
  @@map("Discount")
}
